<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
       x:Class="Splitt.Views.SelectCheckItemView"
       xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
       xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
       xmlns:vm="clr-namespace:Splitt.ViewModels"
       x:DataType="vm:SelectCheckItemViewModel"
       xmlns:model="clr-namespace:SplittLib.Models;assembly=SplittLib">

       <ContentPage.BindingContext>
              <vm:SelectCheckItemViewModel/>
       </ContentPage.BindingContext>

       <ScrollView>
              <VerticalStackLayout Padding="20">

                     <Label Margin="0,2,0,10"
                            Text="{Binding CheckId, StringFormat='Check ID: {0}'}"
                            FontSize="18"
                            FontAttributes="Bold"
                            TextColor="Black"/>

                     <Label Margin="0,0,0,4"
                            Text="Add Check Item"
                            FontSize="16"
                            FontAttributes="Bold"
                            TextColor="Black"
                            HorizontalOptions="Center"/>


                     <Border Stroke="Gray"
                             StrokeThickness="1"
                             Padding="10">
                            <VerticalStackLayout Spacing="10">
                                   <Label Text="Name"
                                          Margin="0,10,0,0"/>
                                   <Entry Margin="0,2,0,0"
                                          Text="{Binding Name}"/>
                                   <Label Text="Description"
                                          Margin="0,10,0,0"/>
                                   <Entry Margin="0,2,0,0"
                                          Text="{Binding Description}"/>
                                   <Label Text="Quantity"
                                          Margin="0,10,0,0"/>
                                   <Entry Margin="0,2,0,0"
                                          Text="{Binding Quantity, Mode=TwoWay}"
                                          Keyboard="Numeric"/>
                                   <Label Text="Unit Price"
                                          Margin="0,10,0,0"/>
                                   <Entry Margin="0,2,0,0"
                                          Text="{Binding UnitPrice, Mode=TwoWay}"
                                          Keyboard="Numeric"/>
                                   <Label Text="{Binding TotalPrice, StringFormat='Total Price: {0}'}"
                                          Margin="0,10,0,10"
                                          FontSize="18"
                                          FontAttributes="Bold"
                                          TextColor="Black"/>
                            </VerticalStackLayout>
                     </Border>


                     <Button
                            Command="{Binding AddCheckItemCommand}"
                            HorizontalOptions="Center"
                            Margin="0,20,0,20"
                            Text="Add Item"/>


                     <Border Stroke="Gray"
                             StrokeThickness="1"
                             BackgroundColor="White"
                             StrokeShape="RoundRectangle 8">
                            <VerticalStackLayout Spacing="0">
                                   <!-- Header Row -->
                                   <Grid Padding="10"
                                         ColumnDefinitions="200, 60, 80"
                                         BackgroundColor="LightGray">
                                          <Label Text="Name"
                                                 FontAttributes="Bold"
                                                 Grid.Column="0"
                                                 HorizontalOptions="Start"/>
                                          <Label Text="Qty"
                                                 FontAttributes="Bold"
                                                 Grid.Column="1"
                                                 HorizontalOptions="Center"/>
                                          <Label Text="Total"
                                                 FontAttributes="Bold"
                                                 Grid.Column="2"
                                                 HorizontalOptions="End"/>
                                   </Grid>
                                   <!-- Scrollable Items -->
                                   <CollectionView ItemsSource="{Binding CheckItems}"
                                                   SelectionMode="None"
                                                   HeightRequest="200"
                                                   BackgroundColor="White">
                                          <CollectionView.ItemTemplate>
                                                 <DataTemplate x:DataType="model:CheckItem">
                                                        <VerticalStackLayout Spacing="0"
                                                                             Padding="0">
                                                               <Grid Padding="10"
                                                                     ColumnDefinitions="200, 60, 80">
                                                                      <Button Text="{Binding Name}"
                                                                              Grid.Column="0"
                                                                              HorizontalOptions="Start"
                                                                              BackgroundColor="Transparent"
                                                                              TextColor="Black"
                                                                              FontSize="12"
                                                                              Command="{Binding Source={RelativeSource AncestorType={x:Type vm:SelectCheckItemViewModel}}, Path=RemoveItemCommand}"
                                                                              CommandParameter="{Binding .}"
                                                                              MaximumHeightRequest="10"/>
                                                                      <Label Text="{Binding Quantity, StringFormat='x{0}'}"
                                                                             Grid.Column="1"
                                                                             HorizontalOptions="Center"
                                                                             VerticalOptions="Center"/>
                                                                      <Label Text="{Binding TotalPrice, StringFormat='${0}'}"
                                                                             Grid.Column="2"
                                                                             HorizontalOptions="End"
                                                                             VerticalOptions="Center"/>
                                                               </Grid>
                                                               <!-- Bottom Divider -->
                                                               <BoxView HeightRequest="1"
                                                                        Color="LightGray"/>
                                                        </VerticalStackLayout>
                                                 </DataTemplate>
                                          </CollectionView.ItemTemplate>
                                   </CollectionView>

                            </VerticalStackLayout>
                     </Border>

                     <Label Text="Tip"
                            Margin="0,10,0,0"/>
                     <Entry Margin="0,5,0,0"
                            Text="{Binding Tip, Mode=TwoWay}"/>
                     <Label Text="{Binding Subtotal, StringFormat='Subtotal: {0}'}"
                            Margin="0,0,0,0"
                            FontSize="16"
                            FontAttributes="Bold"/>
                     <Label Text="{Binding Tax, StringFormat='Tax: {0}'}"
                            Margin="0,0,0,0"
                            FontSize="16"
                            FontAttributes="Bold"/>
                     <Label Text="{Binding Total, StringFormat='Total: {0}'}"
                            Margin="0,0,0,0"
                            FontSize="18"
                            FontAttributes="Bold"
                            TextColor="Black"/>

                     <Button
                            Command="{Binding SubmitCommand}"
                            HorizontalOptions="Center"
                            Margin="0,20,0,20"
                            Text="Split Items"/>
              </VerticalStackLayout>
       </ScrollView>
</ContentPage>