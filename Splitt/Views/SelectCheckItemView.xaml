<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
       x:Class="Splitt.Views.SelectCheckItemView"
       xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
       xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
       xmlns:vm="clr-namespace:Splitt.ViewModels"
       x:DataType="vm:SelectCheckItemViewModel"
       xmlns:model="clr-namespace:SplittLib.Models;assembly=SplittLib">

       <ContentPage.BindingContext>
              <vm:SelectCheckItemViewModel/>
       </ContentPage.BindingContext>

       <ScrollView>
              <VerticalStackLayout Padding="20">

                     <Label Margin="0,2,0,10"
                            Text="{Binding CheckId, StringFormat='Check ID: {0}'}"
                            FontSize="18"
                            FontAttributes="Bold"
                            TextColor="Black"/>

                     <Label Margin="0,0,0,4"
                            Text="Add Check Item"
                            FontSize="16"
                            FontAttributes="Bold"
                            TextColor="Black"
                            HorizontalOptions="Center"/>


                     <Border Stroke="Gray"
                             StrokeThickness="1"
                             StrokeShape="RoundRectangle 8">
                            <Border.Shadow>
                                   <Shadow Offset="0,0"
                                           Opacity="0.4"/>
                            </Border.Shadow>
                            <VerticalStackLayout Spacing="10"
                                                 BackgroundColor="White">
                                   <Label Text="Name"
                                          Margin="10,10,0,0"/>
                                   <Entry Margin="10,2,10,0"
                                          Text="{Binding Name}"/>
                                   <Label Text="Description"
                                          Margin="10,10,0,0"/>
                                   <Entry Margin="10,2,10,0"
                                          Text="{Binding Description}"/>
                                   <Label Text="Quantity"
                                          Margin="10,10,0,0"/>
                                   <Entry Margin="10,2,10,0"
                                          Text="{Binding Quantity, Mode=TwoWay}"
                                          Keyboard="Telephone"/>
                                   <Label Text="Unit Price"
                                          Margin="10,10,0,0"/>
                                   <Entry Margin="10,2,10,0"
                                          Text="{Binding UnitPrice, Mode=TwoWay}"
                                          Keyboard="Numeric"
                                          TextChanged="OnUnitPriceChanged"/>
                                   <Label Text="{Binding TotalPrice, StringFormat='Total Price: {0}'}"
                                          Margin="10,10,0,10"
                                          FontSize="18"
                                          FontAttributes="Bold"
                                          TextColor="Black"/>
                            </VerticalStackLayout>
                     </Border>


                     <Border Stroke="DarkGray"
                             StrokeThickness="1"
                             StrokeShape="RoundRectangle 25"
                             Margin="0,15,0,15"
                             HorizontalOptions="Center">
                            <Border.Shadow>
                                   <Shadow Offset="2,2"
                                           Opacity="0.3"/>
                            </Border.Shadow>
                            <Button
                                   Command="{Binding AddCheckItemCommand}"
                                   HorizontalOptions="Center"
                                   Text="Add Item"/>
                     </Border>


                     <Border Stroke="Gray"
                             StrokeThickness="1"
                             BackgroundColor="White"
                             StrokeShape="RoundRectangle 8">
                            <Border.Shadow>
                                   <Shadow Offset="0,0"
                                           Opacity="0.4"/>
                            </Border.Shadow>
                            <VerticalStackLayout Spacing="0">
                                   <!-- Header Row -->
                                   <Grid Padding="10"
                                         ColumnDefinitions="200, 60, 80"
                                         BackgroundColor="LightGray">
                                          <Label Text="Name"
                                                 FontAttributes="Bold"
                                                 Grid.Column="0"
                                                 HorizontalOptions="Start"/>
                                          <Label Text="Qty"
                                                 FontAttributes="Bold"
                                                 Grid.Column="1"
                                                 HorizontalOptions="Center"/>
                                          <Label Text="Total"
                                                 FontAttributes="Bold"
                                                 Grid.Column="2"
                                                 HorizontalOptions="End"/>
                                   </Grid>
                                   <!-- Scrollable Items -->
                                   <CollectionView ItemsSource="{Binding CheckItems}"
                                                   SelectionMode="None"
                                                   HeightRequest="200"
                                                   BackgroundColor="White">
                                          <CollectionView.ItemTemplate>
                                                 <DataTemplate x:DataType="model:CheckItem">
                                                        <VerticalStackLayout Spacing="0"
                                                                             Padding="0">
                                                               <Grid Padding="10"
                                                                     ColumnDefinitions="200, 60, 80">
                                                                      <Button Text="{Binding Name}"
                                                                              Grid.Column="0"
                                                                              HorizontalOptions="Start"
                                                                              BackgroundColor="Transparent"
                                                                              TextColor="Black"
                                                                              FontSize="12"
                                                                              Command="{Binding Source={RelativeSource AncestorType={x:Type vm:SelectCheckItemViewModel}}, Path=RemoveItemCommand}"
                                                                              CommandParameter="{Binding .}"
                                                                              MaximumHeightRequest="10"/>
                                                                      <Label Text="{Binding Quantity, StringFormat='x{0}'}"
                                                                             Grid.Column="1"
                                                                             HorizontalOptions="Center"
                                                                             VerticalOptions="Center"/>
                                                                      <Label Text="{Binding TotalPrice, StringFormat='${0}'}"
                                                                             Grid.Column="2"
                                                                             HorizontalOptions="End"
                                                                             VerticalOptions="Center"/>
                                                               </Grid>
                                                               <!-- Bottom Divider -->
                                                               <BoxView HeightRequest="1"
                                                                        Color="LightGray"/>
                                                        </VerticalStackLayout>
                                                 </DataTemplate>
                                          </CollectionView.ItemTemplate>
                                   </CollectionView>

                            </VerticalStackLayout>
                     </Border>

                     <BoxView
                            Color="Gray"
                            Margin="0,25,0,0"
                            HeightRequest="1"
                            HorizontalOptions="Fill"/>

                     <Grid ColumnDefinitions="Auto, *"
                           RowDefinitions="Auto, Auto, Auto, Auto"
                           RowSpacing="10"
                           Padding="5">
                            <Label Text="Tip"
                                   FontAttributes="Bold"
                                   FontSize="16"
                                   HorizontalOptions="Start"
                                   VerticalOptions="Center"
                                   Grid.Row="0"
                                   Grid.Column="0"/>
                            <Entry
                                   Text="{Binding Tip, Mode=TwoWay}"
                                   Keyboard="Numeric"
                                   HorizontalOptions="End"
                                   VerticalOptions="Center"
                                   TextChanged="OnTipChanged"
                                   Grid.Row="0"
                                   Grid.Column="1"/>
                            <Label Text="Subtotal"
                                   FontAttributes="Bold"
                                   FontSize="16"
                                   HorizontalOptions="Start"
                                   VerticalOptions="Center"
                                   Grid.Row="1"
                                   Grid.Column="0"/>
                            <Label Text="{Binding Subtotal, StringFormat='${0}'}"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   HorizontalOptions="End"
                                   VerticalOptions="Center"
                                   Grid.Row="1"
                                   Grid.Column="1"/>
                            <Label Text="Tax"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Start"
                                   VerticalOptions="Center"
                                   Grid.Row="2"
                                   Grid.Column="0"/>
                            <Label Text="{Binding Tax, StringFormat='${0}'}"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   HorizontalOptions="End"
                                   VerticalOptions="Center"
                                   Grid.Row="2"
                                   Grid.Column="1"/>
                            <Label Text="Total"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Start"
                                   VerticalOptions="Center"
                                   FontSize="18"
                                   Grid.Row="4"
                                   Grid.Column="0"/>
                            <Label Text="{Binding Total, StringFormat='${0}'}"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   HorizontalOptions="End"
                                   VerticalOptions="Center"
                                   Grid.Row="4"
                                   Grid.Column="1"/>
                     </Grid>

                     <BoxView
                            Color="Gray"
                            Margin="0,10,0,10"
                            HeightRequest="1"
                            HorizontalOptions="Fill"/>

                     <Border Stroke="DarkGray"
                             StrokeThickness="1"
                             StrokeShape="RoundRectangle 25"
                             Margin="0,5,0,5"
                             HorizontalOptions="Center">
                            <Border.Shadow>
                                   <Shadow Offset="2,2"
                                           Opacity="0.3"/>
                            </Border.Shadow>
                            <Button
                                   Command="{Binding SubmitCommand}"
                                   HorizontalOptions="Center"
                                   Text="Split Items"/>
                     </Border>
              </VerticalStackLayout>
       </ScrollView>
</ContentPage>